
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>j201's Meanderings</title>
  <meta name="author" content="j201">

  
  <meta name="description" content="The concept of &lsquo;expressiveness&rsquo; is one that appears a lot in programming language debates. Broadly speaking, it means the ease with which &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://j201.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="j201's Meanderings" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Volkhov' rel='stylesheet' type='text/css'>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="/javascripts/footnote.js" type="text/javascript"></script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41719393-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">j201's Meanderings</a></h1>
  
    <h2>Yet Another JavaScript Blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:j201.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://github.com/j201">j201 on GitHub</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/20/expressing-yourself/">Expressing Yourself</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-20T10:42:00-04:00" pubdate data-updated="true">Apr 20<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/04/20/expressing-yourself/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The concept of &lsquo;expressiveness&rsquo; is one that appears a lot in programming language debates. Broadly speaking, it means the ease with which a language can express ideas. This is often taken to mean whether the language express common constructs prettily and tersely. But I feel that this isn&rsquo;t the whole story. For example, I&rsquo;m not a fan of &lsquo;expressive&rsquo; syntactical constructs like list comprehensions. Sure, they can express some common list operations in a readable manner, but they&rsquo;re inherently limited to the features supported by the syntax. Once you want to do an operation that isn&rsquo;t part of the list comprehension syntax, you have to fall back on the primitive constructs of the language, and you&rsquo;d better hope that they don&rsquo;t uglify the whole thing. I feel that an expressive language should go further.</p>

<p>In particular, it bothers me to see people gushing about how the new Python-ish features of ES6 such as <code>for..of</code>, list comprehensions, and classes will finally make JS expressive. I disagree for a few reasons:</p>

<ul>
<li>Expressive programming is an approach to programming, not a characteristic of the language</li>
<li>This approach is already possible and easy in JS</li>
<li>Whether a language can be used expressively is far more determined by its powerful generic features, such as first-class functions and metaprogramming, than problem-specific syntactical constructs, like list comprehensions</li>
</ul>


<p>Instead, I would contend that expressive programming is about writing operations in a way that closely resembles a simple abstract description of each operation, using as few unimportant programming concerns as possible, and that this can be accomplished without highly specialized syntactical constructs.</p>

<p>I&rsquo;ll show some code to explain. A simple example of a non-expressive construct is the for loop. For example, it&rsquo;s commonly used to do a thing for each element of an array:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Do stuff with arr[i]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Conceptually, we want to just do something for each element of an array, but the for loop forces us to deal instead with handling an index variable and using it. This is an example of <a href="http://en.wikipedia.org/wiki/Accidental_complexity">incidental complexity</a>: it&rsquo;s an implementation detail we don&rsquo;t care about and that gets in the way of expressing the idea we want to express. A more expressive formulation would be the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">forEach</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">el</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Do stuff with el</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll note that this is very close to our original statement of the problem: <em>do a thing for each element of an array</em>, just with the words rearranged. It&rsquo;s way more expressive than the for loop, and we can make it ourselves very easily without needing to wait for the language designers to add special syntactical constructs like <code>foreach</code> or <code>for of</code> loops:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">forEach</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">fn</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// arr.forEach can be used instead, but I&#39;m reimplementing it for the sake of argument</span>
</span></code></pre></td></tr></table></div></figure>


<p>This shows why higher order functions are so important for expressive programming. They let you make abstractions like our forEach function that can abstract over behaviour, rather than just dealing with data structures. This means you have far more flexibility in the expressive constructs you use and you have access to a much wider variety of them without being limited by the syntactical constructs of the language. Any decent functional list library will have a range of functionality many times bigger than specialized list handling syntax can muster.</p>

<p>What this example also shows is that expressive programming is not just a characteristic of the language, it&rsquo;s an approach the programmer must take. This is especially true in JavaScript, where you have access to both high-level functional approaches and low-level C-ish constructs like loops and switch statements. And I would point to Scheme as a great example of a language that despite having few specialized features can be programmed very expressively (see SICP and the beautiful functions therein).</p>

<p>A good way to get used to this approach is to tackle problems in the following way:</p>

<ul>
<li>Determine an approach that will solve your problem in terms of simpler and more generic operations</li>
<li>Write that approach in a straightforward expressive way, even if it means using functions you don&rsquo;t have yet</li>
<li>Implement those functions the same way, writing them expressively in terms of smaller problems</li>
<li>Continue until all of the necessary functions are implemented

<ul>
<li>In some cases, generic operations might need to use low-level approaches, like the <code>forEach</code> function above</li>
</ul>
</li>
</ul>


<p>Let&rsquo;s do an example. <a href="http://projecteuler.net/problem=3">Project Euler problem 3</a> asks for the largest prime factor of 600851475143. I&rsquo;ll use ES6 arrow functions for readability, but these are easily translatable into normal JS functions.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">projectEuler3</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span>
</span><span class='line'>    <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">primeFactors</span><span class="p">(</span><span class="mi">600851475143</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, we&rsquo;ve expressed exactly what we&rsquo;re looking for: the maximum element of the list of prime factors of 600851475143. Now, we need to implement primeFactors. Let&rsquo;s use the following algorithm:</p>

<ul>
<li>Find the first number from 2 to sqrt(x) that is a factor of x</li>
<li>If such a number exists, return that number, along with the prime factors of x divided by that number</li>
<li>Otherwise, return an array just with x (because x is prime)</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">primeFactors</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">factor</span> <span class="o">=</span> <span class="nx">find</span><span class="p">(</span><span class="nx">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">n</span> <span class="o">=&gt;</span> <span class="nx">isFactor</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">x</span><span class="p">));</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">factor</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span>
</span><span class='line'>        <span class="p">[</span><span class="nx">factor</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">primeFactors</span><span class="p">(</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">factor</span><span class="p">))</span> <span class="o">:</span>
</span><span class='line'>        <span class="p">[</span><span class="nx">x</span><span class="p">];</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, really close to how we expressed the solution. But we used the functions <code>find</code>, <code>range</code>, and <code>isFactor</code>, so let&rsquo;s implement those. (The reason for adding one to the square root calculation is that range functions are generally inclusive on the lower bound and exclusive on the upper bound.)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">isFactor</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">isInteger</span><span class="p">(</span><span class="nx">b</span> <span class="o">/</span> <span class="nx">a</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">isInteger</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>A number is a factor of another if the result of their division is an integer, and a number is an integer if the number modulo one is zero. Reads like a book, although in reality you certainly wouldn&rsquo;t constantly reimplement these.</p>

<p>Now we&rsquo;re down to more generic, simpler functions. Unfortunately, given the features JS provides, these have to be a bit more low-level. But they&rsquo;re still much shorter and easy to understand than the monolithic solutions you usually see for these kinds of problems. They&rsquo;re also generic enough to be gotten from libraries or put in a library and reused.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">find</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">pred</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">pred</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">from</span><span class="p">;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">to</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>So here, we&rsquo;re using <code>for</code> loops to implement more the more abstract operations of finding the first element of a list that matches a predicate (a higher order function!) and getting a range of numbers. Any decent functional list library will provide similar functions, and <code>Array.prototype.find</code> is coming in ES6.</p>

<p><a href="http://www.es6fiddle.net/hu8fuftc/">And we&rsquo;re done!</a></p>

<p>So, this is how I see expressive programming. It&rsquo;s about coding your solutions as closely to the conceptual solutions as possible. This can be done with short, simple, pure functions and taking advantage of higher-order functions to make powerful, expressive abstractions. And it has many benefits:</p>

<ul>
<li>The problem-specific functions are short and easily understood</li>
<li>Little incidental complexity</li>
<li>Each function is easily testable and reusable</li>
<li>Understanding and writing each function has a low cognitive load</li>
<li>Low-level and difficult-to-read approaches are only used when really necessary</li>
<li>Allows for easy construction of <a href="http://mitpress.mit.edu/sicp/full-text/sicp/book/node29.html">abstraction barriers</a></li>
<li>No specific syntax needed</li>
</ul>


<p>So, as a JavaScript programmer, the features I am most excited about in ES6 are those that help with this goal, like arrow functions, which make functions easier to read and use, and the new HOFs coming to Array.prototype. Those are the features that really help expressive programming in JS, not limited syntactical additions.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/09/27/functional-list-processing-in-js/">Functional List Processing in JS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-27T14:39:00-04:00" pubdate data-updated="true">Sep 27<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/09/27/functional-list-processing-in-js/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Many functional programming languages such as Scheme, Clojure and Haskell are heavily based on list processing, which has proved to be a useful approach for dealing with data and code alike. In particular, they tend to have a wide range of useful list processing functions that can simplify the use of lists while allowing them to replace constructs like loops. While JS doesn&rsquo;t share the elegance or theoretical purity of such languages, it took some cues from them in ES5 when the <code>map</code>, <code>reduce</code>, <code>reduceRight</code>, <code>some</code>, <code>every</code>, and <code>filter</code> functions were added to <code>Array.prototype</code>. These higher-order functions added flexibility, better scoping, and simplicity to programming techniques that were usually previously accomplished with <code>for</code> loops. JS is still lacking many of the useful features that functional languages use for creating and processing lists, but many of them can be implemented fairly easily in order to make it easier to use arrays and banish loops once and for all.</p>

<h2><code>range</code>, or list comprehensions without the sugar</h2>

<p>Languages like Python and CoffeeScript have <a href="http://en.wikipedia.org/wiki/List_comprehension">list comprehensions</a>: terse syntaxes for making lists with given ranges and constraints. However, I agree with the LISP philosophy that you shouldn&rsquo;t solve such simple problems by throwing more syntax at them &ndash; existing syntax should be used instead. For example, Clojure uses a couple of regular functions to do the same thing: whereas you could write <code>(i * 5 for i in [1..5])</code> in CoffeeScript, the equivalent Clojure would look like <code>(for [i (range 1 6)] (* i 5))</code>, which justs uses function calls and a binding form, maintaining syntactic simplicity. Well, the same approach can be applied in JavaScript with the following helper function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">range</span><span class="p">(</span><span class="nx">startOrEnd</span><span class="p">,</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">start</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">start</span> <span class="o">=</span> <span class="nx">startOrEnd</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">end</span> <span class="o">=</span> <span class="nx">startOrEnd</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">step</span> <span class="o">=</span> <span class="nx">step</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">step</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">start</span> <span class="o">&gt;</span> <span class="nx">end</span> <span class="o">||</span> <span class="nx">step</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">start</span> <span class="o">&lt;</span> <span class="nx">end</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">[];</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">((</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="nx">step</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">step</span> <span class="o">+</span> <span class="nx">start</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This function acts more or less the same way as <a href="http://clojuredocs.org/clojure_core/clojure.core/range">Clojure&rsquo;s range function</a>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">range</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// [0, 1, 2, 3, 4]</span>
</span><span class='line'><span class="nx">range</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// [-2, -1, 0, 1, 2]</span>
</span><span class='line'><span class="nx">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// [10, 9, 8, 7, 6, 5, 4, 3, 2, 1]</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, first of all, this pretty much replaces <code>for</code> loops. Instead of writing <code>for (var i = 0; i &lt; 10; i += 2) { ...</code>, you can write <code>range(0, 10, 2).forEach(function(i) { ...</code>, which is clearer in my opinion and carries other stylistic benefits. Also note that if you use <code>map</code> instead of <code>forEach</code>, you can get an array of results as well as getting the for loop behaviour, which can be very convenient and which brings us to our final goal of emulating list comprehensions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="mi">5</span><span class="p">;});</span> <span class="c1">// Tadaa! [5, 10, 15, 20, 25]</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s nice and useful, but not very pretty. Fortunately ES6 arrow functions will make it look much nicer. (ES6 also has list comprehensions, which I don&rsquo;t think are really necessary, but ES6 is proving to be a mish-mash of features anyway).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// [5, 10, 15, 20, 25]</span>
</span></code></pre></td></tr></table></div></figure>


<p>And there you have it: the <code>for</code> loop and loop comprehension killer. You&rsquo;ll occasionally see hacks like <code>Array.apply(null, Array(10)).map(Number.call, Number)</code> to get a range on the fly, but you&rsquo;re much better off doing it properly with a helper function or using one from a library like Underscore.</p>

<p>More than any other function on this page, I&rsquo;d like to see this implemented as a native function, <code>Array.range</code> perhaps. It&rsquo;s really the last piece in the puzzle to making full use of <code>forEach</code>, <code>map</code>, etc.</p>

<h2>Zipping around</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">zipWith</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">arrays</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">arrays</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;zip requires at least 2 arrays&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">arrays</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">minLength</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">minLength</span> <span class="o">?</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="nx">minLength</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span> <span class="nx">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arrays</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>        <span class="p">})));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* </span>
</span><span class='line'><span class="cm">     * If you have range(...), this last section could be expressed more cleanly as</span>
</span><span class='line'><span class="cm">     * return range(length).map(function(i) {</span>
</span><span class='line'><span class="cm">     *     return fn.apply(null, arrays.map(function(arr) {</span>
</span><span class='line'><span class="cm">     *         return arr[i];</span>
</span><span class='line'><span class="cm">     *     }));</span>
</span><span class='line'><span class="cm">     * });</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This one is in Haskell and Clojure (as <code>map</code>). It takes a function as its first parameter and at least two arrays as subsequent parameters, then it returns an array of the results of calling the function with the array elements at the corresponding indices as arguments. So for example, if you called <code>zipWith(fn, arr1, arr2)</code>, it would return <code>[fn(arr1[0], arr2[0]), fn(arr1[1], arr2[1]), fn(arr1[2], arr2[2]), ...]</code>. <code>zipWith.apply(...)</code> is especially useful for working with matrices, but it has a range of other uses. Here are a couple of practical examples:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">arr1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="nx">arr2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Sum the corresponding elements of the arrays</span>
</span><span class='line'><span class="nx">zipWith</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span> <span class="p">},</span> <span class="nx">arr1</span><span class="p">,</span> <span class="nx">arr2</span><span class="p">);</span> <span class="c1">// [7, 4, 2]</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Test if the arrays are equal</span>
</span><span class='line'><span class="nx">zipWith</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">;</span> <span class="p">},</span> <span class="nx">arr1</span><span class="p">,</span> <span class="nx">arr2</span><span class="p">).</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span> <span class="p">});</span> <span class="c1">// false</span>
</span></code></pre></td></tr></table></div></figure>


<p>And while we&rsquo;re talking about array equality,</p>

<h2>Array equality</h2>

<p>When you&rsquo;re using arrays as your main data structure, you need to be able to check whether one array has the same values as another. There are good reasons for arrays to be treated as unique for comparison operators, but you <em>will</em> need an equation like this in order to do functional-style list processing. Note that this uses deep equality testing for arrays and shallow equality testing for other objects.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">arraysEqual</span><span class="p">(</span><span class="nx">arr1</span><span class="p">,</span> <span class="nx">arr2</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">arr1</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">arr2</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">arr1</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">arr2</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">arr1</span> <span class="o">===</span> <span class="nx">arr2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr1</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">arr1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">arr2</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">arraysEqual</span><span class="p">(</span><span class="nx">arr1</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">arr2</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
</span><span class='line'>                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">arr1</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">arr2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span><span class='line'>                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">arraysEqual</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]);</span> <span class="c1">// true</span>
</span><span class='line'><span class="nx">arraysEqual</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span> <span class="c1">// false</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Repetition</h2>

<p><code>range</code> is by far the most useful list builder function, but sometimes it comes in handy to make a list that&rsquo;s just the same thing over and over again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">repeat</span><span class="p">(</span><span class="nx">times</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="nx">times</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">times</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And some examples:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// Multiplying a string</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">googol</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="nx">repeat</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// &quot;10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Roll 10d6</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">rollDie</span><span class="p">(</span><span class="nx">sides</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">sides</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">repeat</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">rollDie</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span> <span class="p">});</span> <span class="c1">// 38 (for example)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Nesting and unnesting</h2>

<p>Last of all, it&rsquo;s often useful to deal with lists within lists, so here are a couple of functions for that. This first one returns a list split up into a sublists of a given length.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">partition</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">n</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Again, range would make this part nicer</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">([]);</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">result</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">n</span> <span class="o">*</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">partition</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">range</span><span class="p">(</span><span class="mi">9</span><span class="p">));</span> <span class="c1">// [[0, 1, 2], [3, 4, 5], [6, 7, 8]]</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Make an empty 4*4 matrix</span>
</span><span class='line'><span class="nx">partition</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nx">repeat</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="c1">// [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>And this takes a nested list and flattens it into a single layer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">flatten</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="nx">arr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span>
</span><span class='line'>            <span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">el</span><span class="p">));</span> <span class="c1">// w00t recursion</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">flatten</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">[[[</span><span class="mi">5</span><span class="p">]]]]]);</span> <span class="c1">// [1, 2, 3, 4, 5]</span>
</span><span class='line'>
</span><span class='line'><span class="nx">flatten</span><span class="p">(</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nx">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)));</span> <span class="c1">// [0, 1, 0, 1, 0, 1, 0, 1]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>The point of these functions isn&rsquo;t just to make list processing a bit less wordy; they allow you to manipulate lists in a completely different way. Instead of dealing with lists in they way you generally see in the functions themselves &ndash; changing an index variable to represent the current element, pushing and changing arrays of results, etc. &ndash; you can express most list functions in a single statement, with no variable modifications whatsoever. Then, you can build up list operations and eventually entire programs by combining such functions into other functions, without having to mentally keep track of variables changing state. It takes some getting used to, but it&rsquo;s a great way to program.</p>

<p>Here&rsquo;s an example: the <a href="http://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher">Vigenre cipher</a>. Basically, it&rsquo;s a Caesar cipher, but each letter is shifted by a different amount depending on a key, which if too short is repeated.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// Does modular addition of capital letters, e.g., Y + D = B</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">modAddCapsLetters</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">((</span><span class="nx">a</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">65</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span> <span class="o">+</span> <span class="mi">65</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// The imperative way</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">vigenereImp</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">keyPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">modAddCapsLetters</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span> <span class="nx">key</span><span class="p">[</span><span class="nx">keyPos</span><span class="p">]));</span>
</span><span class='line'>        <span class="nx">keyPos</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">keyPos</span> <span class="o">&gt;=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
</span><span class='line'>            <span class="nx">keyPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// The functional way</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">vigenere</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">keyRepeats</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">repeatedKey</span> <span class="o">=</span> <span class="nx">flatten</span><span class="p">(</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">keyRepeats</span><span class="p">,</span> <span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)));</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">zipWith</span><span class="p">(</span><span class="nx">modAddCapsLetters</span><span class="p">,</span> <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nx">repeatedKey</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">vigenere</span><span class="p">(</span><span class="s2">&quot;LOOPSAREFORTHEWEAK&quot;</span><span class="p">,</span> <span class="s2">&quot;LISPY&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// &quot;WWGEQLZWUMCBZTUPIC&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So the imperative way does it step by step. It creates a variable <code>i</code> that increases for each letter, a variable <code>keyPos</code> that increases for each letter but gets reset to 0 once it&rsquo;s equal to the key length, and then shifts the letter in the input string by the given letter in the key. It concatenates each one to the end of a result string then returns it. Simple enough, but increases in complexity based on the amount of mutable data you have to keep track of. The functional way, instead, finds out how many times to repeat the key, creates a new array of letters with the key repeated the necessary amount, and then zips that with the original string using <code>modAddCapsLetters</code>. It&rsquo;s really a matter of preference, but I find the latter way of doing things conceptually simpler, and that helps a lot when building larger programs.</p>

<p>Check out Underscore or Lo-Dash for implementations of many of these functions.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/03/evil-js-with-considered-somewhat-useful/">Evil JS: With Considered Somewhat Useful</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-03T12:16:00-04:00" pubdate data-updated="true">Aug 3<span>rd</span>, 2013</time>
        
         | <a href="/blog/2013/08/03/evil-js-with-considered-somewhat-useful/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Note: Do not try this at work. It&rsquo;s not that bad but your coworkers and Douglas Crockford might get cross.</em></p>

<p><code>with</code> statements are a little-used, oft-reviled, and underappreciated part of JavaScript. Basically, they allow you to write a statement, often a block, with the properties of a given object added to the scope. Here&rsquo;s an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">with</span><span class="p">(</span><span class="nb">Math</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">cos</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">PI</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">x</span><span class="p">;</span> <span class="c1">// -1</span>
</span><span class='line'><span class="nx">y</span><span class="p">;</span> <span class="c1">// -1</span>
</span></code></pre></td></tr></table></div></figure>


<p>The thing is, <code>with</code> statements are almost universally renounced in the JavaScript community. For example, you can read Douglas Crockford&rsquo;s attack on <code>with</code> from 2006 <a href="http://yuiblog.com/blog/2006/04/11/with-statement-considered-harmful/">here</a>. First of all, <code>with</code> can slow code down by making it difficult for the engine to know what variable is being referred to. But the main problem with <code>with</code> is that it complicates JS&rsquo;s notion of scope. Without <code>with</code>, the variables available in a scope are all of the global variables plus any variables made in local scopes using <code>var</code> or <code>function</code> statements. All of these variables can be both accessed and modified. But using <code>with</code> adds variables to the local scope that were not declared with a <code>var</code> or <code>function</code> statement and shadow those that were. Here&rsquo;s an example of the confusion that can be caused:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">a</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">b</span> <span class="o">:</span> <span class="mi">2</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">with</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">b</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">c</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, what are the values of <code>obj.a</code>, <code>obj.b</code>, <code>obj.c</code>, <code>a</code>, <code>b</code>, and <code>c</code>? ANSWER: <span class="spoiler"><code>obj</code> is <code>{a : 3, b : 5}</code>, <code>a</code> isn&rsquo;t defined, <code>b</code> is 4, and <code>c</code> is 6.</span></p>

<p>So there are good reasons to avoid <code>with</code>. In fact, ES5&rsquo;s strict mode prohibits its use. But the level of hatred and fear directed at it isn&rsquo;t proportional to its flaws and ignores the legitimate uses of with, which I&rsquo;ll cover now.</p>

<h3>Libraries and Modules</h3>

<p>To use a library in JS, one generally has to constantly refer to its object when using its functions, for example using <code>jQuery.ajax</code> instead of <code>ajax</code>. This has led JS libraries to adopt short names such as <code>goog</code>, <code>_</code>, or <code>$</code> for somewhat easier typing, but with the costs of poor readability and losing useful short local variable names. Not adding the library functions to the scope is fine for libraries that you aren&rsquo;t using much, but can be inconvenient for libraries you&rsquo;re using heavily, which is why most programming languages provide a way to import the functions of a module into the current scope. Well, JS has one too:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Returns a random angle in radians from a circle divided into the given number of steps</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">randomAngle</span><span class="p">(</span><span class="nx">steps</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">with</span><span class="p">(</span><span class="nb">Math</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">steps</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">PI</span><span class="p">;</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">floor</span><span class="p">(</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">steps</span><span class="p">)</span> <span class="o">/</span> <span class="nx">steps</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">PI</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">randomAngle2</span><span class="p">(</span><span class="nx">steps</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">steps</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">steps</span><span class="p">)</span> <span class="o">/</span> <span class="nx">steps</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yes, it&rsquo;s the same <code>Math</code> example. But it shows an important point: <code>with</code> can make dealing with libraries and built-in modules a lot easier. Unfortunately, with current attitudes towards <code>with</code>, we&rsquo;re stuck waiting until ES6 for a (hopefully) accepted way to do this.</p>

<h3>Block Scope</h3>

<p>One oddity that makes JavaScript different from most C-style languages is the lack of block scope. Instead of local variables beings scoped to nearest block they&rsquo;re declared in (delimited by <code>{</code> and <code>}</code>), like in C or Java, JS variables are scoped to the nearest <code>function() {...}</code> in which they are declared. This is mostly fine (and in my opinion, not a problem at all if you use functional array iterators), but can be occasionally problematic.</p>

<p>A common issue in asynchronous JS is using callbacks in a loop:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span> <span class="p">},</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// From console:</span>
</span><span class='line'><span class="c1">// 5</span>
</span><span class='line'><span class="c1">// 5</span>
</span><span class='line'><span class="c1">// 5</span>
</span><span class='line'><span class="c1">// 5</span>
</span><span class='line'><span class="c1">// 5</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, since the <code>for</code> loop finished executing before the callbacks were executed, the value of <code>i</code> is 5 every time.  In other languages, to get around this, you&rsquo;d just add a block-scoped variable for each iteration of the loop. In fact, this can be done right now in Firefox, but won&rsquo;t be standard until ES6 (see Solution 1 below). So, the standard solution is to wrap the whole thing in an <a href="http://en.wikipedia.org/wiki/IIFE">IIFE</a> (see Solution 2) which is widely supported, but adds a lot of visual noise. The other solution, is to use <code>with</code> to emulate a block scope (Solution 3):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Solution 1 - Elegant, but not widely supported</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span> <span class="c1">// A block scoped variable</span>
</span><span class='line'>    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span> <span class="p">},</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Solution 2 - Idiomatic but ugly</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span> <span class="p">},</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'>    <span class="p">})(</span><span class="nx">i</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Solution 3 - Widely supported and readable</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">with</span> <span class="p">({</span><span class="nx">j</span> <span class="o">:</span> <span class="nx">i</span><span class="p">})</span>
</span><span class='line'>        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span> <span class="p">},</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// From console:</span>
</span><span class='line'><span class="c1">// 0</span>
</span><span class='line'><span class="c1">// 1</span>
</span><span class='line'><span class="c1">// 2</span>
</span><span class='line'><span class="c1">// 3</span>
</span><span class='line'><span class="c1">// 4</span>
</span></code></pre></td></tr></table></div></figure>


<p>Basically, <code>with</code> lets you make block scoped variables. In fact, it&rsquo;s very similar to the <code>let</code> blocks that are coming in ES6:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">a</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">let</span> <span class="p">(</span><span class="nx">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">a</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">+</span> <span class="nx">c</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">a</span><span class="p">;</span> <span class="c1">// 5</span>
</span><span class='line'>
</span><span class='line'><span class="kd">with</span> <span class="p">({</span><span class="nx">b</span> <span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">c</span> <span class="o">:</span> <span class="mi">7</span><span class="p">})</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">a</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">+</span> <span class="nx">c</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">a</span><span class="p">;</span> <span class="c1">// 11</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, while function scoped variables are usually adequate, <code>with</code> lets you use block scoping when you need it.</p>

<h3>Summary</h3>

<h4>Pros:</h4>

<ul>
<li><code>with</code> makes it easier to work with libraries and modules.</li>
<li><code>with</code> allows you to clearly emulate block scope.</li>
<li>In general, using <code>with</code> sparingly can make your code easier to read and write.</li>
</ul>


<h4>Cons:</h4>

<ul>
<li>Using <code>with</code> poorly can result in unclear code.</li>
<li><code>with</code> is rejected by most linters and style guides.</li>
<li><code>with</code> can make code slower.</li>
<li>ES5 strict mode forbids the use of <code>with</code>.</li>
</ul>


<h3>Conclusion</h3>

<p>I&rsquo;ve identified two cases where <code>with</code> can make for clearer code and emulate features that exist in most other languages. However, the JS community&rsquo;s aversion to <code>with</code> makes it almost unusable except in personal projects. Fortunately, both of its use cases will be replaced in ES6 by <code>let</code> and <code>import</code>, but for now, many coders are depriving themselves of a useful tool.So, don&rsquo;t use it at work, but if you have some hobby coding where readability is more important than speed, don&rsquo;t be too afraid to use <code>with</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/22/js-object-literal-inheritance/">JS Object Literal Inheritance</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-22T10:50:00-04:00" pubdate data-updated="true">Jun 22<span>nd</span>, 2013</time>
        
         | <a href="/blog/2013/06/22/js-object-literal-inheritance/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A JavaScript question that often pops up is &ldquo;How do I set the prototype of an object literal?&rdquo; The short answer is that right now, you can&rsquo;t. When ES6 standardizes the <code>__proto__</code> property, you&rsquo;ll be able to do so directly, but right now, there&rsquo;s no native language construct. The good news is that it is downright simple to make a helper function that will let you use object literals in inheritance:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">proto</span><span class="p">,</span> <span class="nx">literal</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">proto</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">literal</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">literal</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You use it by calling it with the parent object as the first argument and the literal with the changes you want to make as the second: <code>var myObj = extend(parent, {foo : 2, bar : 3});</code> Here are some more examples:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">dog</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">mammal</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">domestic</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">weight</span> <span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">speak</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s2">&quot;woof&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">littleDog</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">dog</span><span class="p">,</span> <span class="p">{</span><span class="nx">weight</span> <span class="o">:</span> <span class="mi">10</span><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">littleDog</span><span class="p">.</span><span class="nx">speak</span><span class="p">();</span> <span class="c1">// &quot;woof&quot;</span>
</span><span class='line'><span class="nx">littleDog</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span> <span class="c1">// 10</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">cat</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">dog</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">weight</span> <span class="o">:</span> <span class="mi">12</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">speak</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s2">&quot;meow&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">breed</span> <span class="o">:</span> <span class="s2">&quot;siamese&quot;</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">cat</span><span class="p">.</span><span class="nx">mammal</span><span class="p">;</span> <span class="c1">// true</span>
</span><span class='line'><span class="nx">cat</span><span class="p">.</span><span class="nx">speak</span><span class="p">();</span> <span class="c1">// &quot;meow&quot;</span>
</span><span class='line'><span class="nx">cat</span><span class="p">.</span><span class="nx">breed</span><span class="p">;</span> <span class="c1">// &quot;siamese&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So there you have it, an easy and useful construct for better differential inheritance. I&rsquo;m sure I&rsquo;m not the first person to use a function like this, and I bet you can find oodles of helper libraries that have something similar, but I think the ease with which you can make such an extension to JS&rsquo;s OOP model shows how awesome and flexible it is.</p>

<h5>Notes:</h5>

<ul>
<li><code>extend</code> requires ES5, or at least shims for <code>Object.create</code>, <code>Object.keys</code>, and <code>Array#forEach</code>. Here&rsquo;s a more complex ES3-compatible version:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">F</span><span class="p">(){}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">proto</span><span class="p">,</span> <span class="nx">literal</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">F</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">proto</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">F</span><span class="p">();</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">literal</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">literal</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">result</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">literal</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'><span class="p">}();</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>Object.create</code> does take a second parameter that works in the same way as <code>extend</code>&rsquo;s, but it uses property descriptors rather than simple properties. So using it would look something like <code>var myObj = Object.create(parent, {foo : {configurable : true, writable : true, enumerable : true, value: 2}});</code>. A bit unwieldy.</li>
<li>Since <code>extend</code> copies the properties over from the object passed as the second parameter, you can use an existing object to specify the differences and it won&rsquo;t be modified.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/16/evil-js-macros/">Evil JS: Macros</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-16T14:37:00-04:00" pubdate data-updated="true">Jun 16<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/06/16/evil-js-macros/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Note: Don&rsquo;t try this at work. This is bad code that shouldn&rsquo;t be used in production.</em></p>

<p>As every JS hacker knows, <code>eval</code> is evil. It&rsquo;s slow, insecure, and generally unnecessary. The same goes for the <code>Function</code> constructor, which can, but shouldn&rsquo;t be used to create functions using strings to specify the arguments and body. But the badness of <code>eval</code> and <code>Function</code> doesn&rsquo;t mean you can&rsquo;t have some fun with them.</p>

<p><code>Function.prototype.toString</code> is a function that returns the source code of the function it&rsquo;s called from. For example,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">add</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">&quot;function (x, y) {</span>
</span><span class='line'><span class="cm">    return x + y;</span>
</span><span class='line'><span class="cm">}&quot;</span>
</span><span class='line'><span class="cm">*/</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a feature that is mostly used in debugging, but you&rsquo;ll note that since we can get the function as a string, we can modify it and pass it to the Function constructor. This allows us to implement a feature JS has been sorely lacking, C-style macros!</p>

<h3>Simple Replacements</h3>

<p>So the first thing to implement is simple replacements, like #defines without arguments. Let&rsquo;s use an object to represent these definitions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">defines</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">PI</span> <span class="o">:</span> <span class="s1">&#39;3.14159&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">E</span> <span class="o">:</span> <span class="s1">&#39;2.71828&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">GREETING</span> <span class="o">:</span> <span class="s1">&#39;&quot;Hello, &quot;&#39;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>And now we can implement the first version of the JS preprocesser (let&rsquo;s call it the JSPP). It takes a definition object and a function and returns another function with the macro expansion applied:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">getBody</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Gets the body of a function as a string</span>
</span><span class='line'>    <span class="nx">fnStr</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">fnStr</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">fnStr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">fnStr</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">getArgs</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Gets the arguments of a function as an array of strings</span>
</span><span class='line'>    <span class="nx">fnStr</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">fnStr</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">fnStr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">fnStr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span> <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">JSPP</span><span class="p">(</span><span class="nx">defines</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">getArgs</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Do the replacements</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">defines</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">replacement</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Uses a RegExp to ensure that the macro name has non-word characters on either side</span>
</span><span class='line'>            <span class="c1">// Note that macro names should only use \w characters</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;(\\W+)&#39;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39;(\\W+)&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">),</span> <span class="s1">&#39;$1&#39;</span> <span class="o">+</span> <span class="nx">defines</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;$2&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">},</span> <span class="nx">getBody</span><span class="p">(</span><span class="nx">fn</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Use the function constructor to rebuild the function</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">body</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Example usage:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">defines</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">PI</span> <span class="o">:</span> <span class="s1">&#39;3.14159&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">E</span> <span class="o">:</span> <span class="s1">&#39;2.71828&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">GREETING</span> <span class="o">:</span> <span class="s1">&#39;&quot;Hello, &quot;&#39;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">doStuff</span> <span class="o">=</span> <span class="nx">JSPP</span><span class="p">(</span><span class="nx">defines</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">?</span> <span class="nx">PI</span> <span class="o">+</span> <span class="nx">E</span> <span class="o">*</span> <span class="nx">val</span> <span class="o">:</span> <span class="nx">GREETING</span> <span class="o">+</span> <span class="nx">val</span><span class="p">;</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">doStuff</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 8.57815</span>
</span><span class='line'><span class="nx">doStuff</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span> <span class="c1">// Hello, Bob</span>
</span><span class='line'><span class="nx">doStuff</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="c1">// function anonymous(val) { return typeof val === &#39;number&#39; ? 3.14159 + 2.71828 * val : &quot;Hello, &quot; + val; }</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Function-like Macros</h3>

<p>Okay, let&rsquo;s go one level deeper: macro arguments. We&rsquo;ll use the same syntax as the <code>Function</code> constructor, argument strings followed by body, except in an array:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">defines</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">ABS</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;((x)&lt;0?-(x):(x))&#39;</span><span class="p">]</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the new (buggy) JSPP implementation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">getBody</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Gets the body of a function as a string</span>
</span><span class='line'>    <span class="nx">fnStr</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">fnStr</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">fnStr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">fnStr</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">getArgs</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Gets the arguments of a function as an array of strings</span>
</span><span class='line'>    <span class="nx">fnStr</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">fnStr</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">fnStr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">fnStr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span> <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">JSPP</span><span class="p">(</span><span class="nx">defines</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">getArgs</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Do the replacements</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">defines</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">defines</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Do a simple replacement</span>
</span><span class='line'>                <span class="k">return</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;(\\W+)&#39;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39;(\\W+)&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">),</span> <span class="s1">&#39;$1&#39;</span> <span class="o">+</span> <span class="nx">defines</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;$2&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Do a replacement with arguments</span>
</span><span class='line'>                <span class="c1">// First, convert the arguments into regex replacement patterns, such as $1 or $23</span>
</span><span class='line'>                <span class="kd">var</span> <span class="nx">macroBody</span> <span class="o">=</span> <span class="nx">defines</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">defines</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span><span class='line'>                <span class="kd">var</span> <span class="nx">macroArgs</span> <span class="o">=</span> <span class="nx">defines</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>                <span class="kd">var</span> <span class="nx">replacement</span> <span class="o">=</span> <span class="nx">macroArgs</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">arg</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="k">return</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nb">RegExp</span><span class="p">(</span><span class="nx">arg</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">),</span> <span class="s1">&#39;$&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
</span><span class='line'>                <span class="p">},</span> <span class="nx">macroBody</span><span class="p">);</span>
</span><span class='line'>                <span class="c1">// Now, use RegExp capturing to apply the replacement</span>
</span><span class='line'>                <span class="c1">// Note that macro names can&#39;t have regex metacharacters, macro arguments cannot have commas</span>
</span><span class='line'>                <span class="c1">// and will often fail if they have ending parens, and there must be at least one argument.</span>
</span><span class='line'>                <span class="c1">// This is a messy, bad, but easy way of doing the replacement,</span>
</span><span class='line'>                <span class="c1">// which fits with the theme of the post, I feel.</span>
</span><span class='line'>                <span class="k">return</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nb">RegExp</span><span class="p">(</span><span class="nx">key</span> <span class="o">+</span> <span class="c1">// The macro name</span>
</span><span class='line'>                                           <span class="s1">&#39;\\s*\\(\\s*(.+?)&#39;</span> <span class="o">+</span> <span class="c1">// The initial paren and first argument</span>
</span><span class='line'>                                           <span class="nb">Array</span><span class="p">(</span><span class="nx">macroArgs</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\\s*,\\s*(.+?)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="c1">// The other args, separated by commas</span>
</span><span class='line'>                                           <span class="s1">&#39;\\s*\\)&#39;</span><span class="p">,</span> <span class="c1">// The final paren</span>
</span><span class='line'>                                           <span class="s1">&#39;g&#39;</span><span class="p">),</span> <span class="nx">replacement</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span> <span class="nx">getBody</span><span class="p">(</span><span class="nx">fn</span><span class="p">));</span>
</span><span class='line'>    <span class="c1">// Use the function constructor to rebuild the function</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">body</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Example usage:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">defines</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">PI</span> <span class="o">:</span> <span class="s1">&#39;3.14159&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">E</span> <span class="o">:</span> <span class="s1">&#39;2.71828&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">ABS</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;((x)&lt;0?-(x):(x))&#39;</span><span class="p">],</span>
</span><span class='line'>    <span class="nx">RESISTORS_PARALLEL</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;((a)*(b)/((a)+(b)))&#39;</span><span class="p">]</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">doStuff</span> <span class="o">=</span> <span class="nx">JSPP</span><span class="p">(</span><span class="nx">defines</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">RESISTORS_PARALLEL</span><span class="p">(</span><span class="nx">PI</span><span class="p">,</span> <span class="nx">E</span><span class="p">)</span> <span class="o">*</span> <span class="nx">ABS</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">doStuff</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 2.9146452959536644</span>
</span><span class='line'><span class="nx">doStuff</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 2.9146452959536644</span>
</span><span class='line'><span class="nx">doStuff</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">function anonymous(val) {</span>
</span><span class='line'><span class="cm">    return ((3.14159)*(2.71828)/((3.14159)+(2.71828))) * ((val)&lt;0?-(val):(val));</span>
</span><span class='line'><span class="cm">}</span>
</span><span class='line'><span class="cm">*/</span>
</span></code></pre></td></tr></table></div></figure>


<p>So there you go, everyone&rsquo;s favourite preprocesser partially ported to JavaScript! And while this is not a good use of <code>Function</code> and <code>Function.prototype.toString</code>, it does show their power. They both have legitimate purposes, and if you&rsquo;re not afraid to go down that road, you can do some pretty wacky stuff with them.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/15/hello-world/">Hello, World!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-15T18:21:00-04:00" pubdate data-updated="true">Jun 15<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/06/15/hello-world/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Good afternoon, Internet!</p>

<p>So I&rsquo;ve figured I need a place to store neat things I find in JS and other programming tricks. Hopefully someone else can benefit from them.</p>

<p>So, without further ado,</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">petStore</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'><span class="nx">petStore</span><span class="p">.</span><span class="nx">birds</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s1">&#39;American Bushtit&#39;</span> <span class="o">:</span> <span class="s1">&#39;$98.99&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Antipodean Albatross&#39;</span> <span class="o">:</span> <span class="s1">&#39;$12.49&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Auckland Merganser&#39;</span> <span class="o">:</span> <span class="s1">&#39;$11.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Barn Owl&#39;</span> <span class="o">:</span> <span class="s1">&#39;$4.97&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Chestnut-crested Yuhina&#39;</span> <span class="o">:</span> <span class="s1">&#39;$25.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Chiriqui Yellowthroat&#39;</span> <span class="o">:</span> <span class="s1">&#39;$9.99&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Common Redpoll&#39;</span> <span class="o">:</span> <span class="s1">&#39;$5.50&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Common Yellowthroat&#39;</span> <span class="o">:</span> <span class="s1">&#39;$8.99&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Crested Drongo&#39;</span> <span class="o">:</span> <span class="s1">&#39;$12.50&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Crested Quetzal&#39;</span> <span class="o">:</span> <span class="s1">&#39;$44.99&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Dimorphic Egret&#39;</span> <span class="o">:</span> <span class="s1">&#39;$17.99&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Doherty\&#39;s Bushshrike&#39;</span> <span class="o">:</span> <span class="s1">&#39;$10.05&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Dwarf Bittern&#39;</span> <span class="o">:</span> <span class="s1">&#39;$14.98&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span><span class='line'>    <span class="nb">Object</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">petStore</span><span class="p">.</span><span class="nx">birds</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">((</span><span class="o">-</span><span class="s1">&#39;Bonjour, monde!&#39;</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">petStore</span><span class="p">.</span><span class="nx">birds</span><span class="p">[</span><span class="nx">a</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="s1">&#39;Morning, all!&#39;</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">petStore</span><span class="p">.</span><span class="nx">birds</span><span class="p">[</span><span class="nx">b</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;What\&#39;s up, bro!&#39;</span><span class="p">.</span><span class="nx">replace</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">s</span><span class="p">,[</span><span class="sr">/[^A-Z]/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span> <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;Howdy, y\&#39;all!&#39;</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])()</span><span class="o">-</span><span class="mi">0101</span><span class="p">)</span><span class="o">*</span><span class="mi">032</span><span class="o">+</span><span class="s1">&#39;Greetings, Earthlings!&#39;</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])()</span><span class="o">-</span><span class="mi">0101</span><span class="p">;})</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;Salutations, Earth!&#39;</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">n</span><span class="o">+</span><span class="mh">0x20</span><span class="p">);</span> <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;Adios, amigo&#39;</span><span class="p">.</span><span class="nx">match</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/20/expressing-yourself/">Expressing Yourself</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/27/functional-list-processing-in-js/">Functional List Processing in JS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/03/evil-js-with-considered-somewhat-useful/">Evil JS: With Considered Somewhat Useful</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/22/js-object-literal-inheritance/">JS Object Literal Inheritance</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/16/evil-js-macros/">Evil JS: Macros</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - j201 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'j201';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
